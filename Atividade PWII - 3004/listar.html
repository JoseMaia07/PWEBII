<html>
<head>
    <title>Pagina</title>
    <meta charset="UTF-8">
</head>
<body>
    <div id="teste1"></div>
    <input type="button" onclick="location.href='adicionar.html'" value="Novo Veículo">
    <div id="tabela_veiculos"></div>
    <div id="paginacao" style="margin-top: 10px; text-align: center;">
        <button onclick="paginaAnterior()">Voltar</button>
        <span id="info_pagina"></span>
        <button onclick="proximaPagina()">Próximo</button>
    </div>

    <div class="loader" id="loader" style="display: none;">
        <h2>Carregando..</h2>
        <img src="preload.gif" style="height:50px">
        <p>Aguarde enquanto recebemos os dados de veículos...</p>
    </div>

<script>
    var lista = [];
    var paginaAtual = 0;
    var itensPorPagina = 5;

    async function pegaDados() {
        const response = await fetch('https://mauricio.inf.br/p6/api/list/');
        const names = await response.json();
        lista = names.veiculos;
        gerarTabela();
        hideDialog();
    }

    function gerarTabela() {
        const inicio = paginaAtual * itensPorPagina;
        const fim = inicio + itensPorPagina;
        const listaPagina = lista.slice(inicio, fim);

        let tabela = "<table style='width: 100%'>";
        tabela += "<thead><tr><th style='text-align: center;'>Placas</th><th style='text-align: center;'>&nbsp;</th></tr></thead>";

        for (let i = 0; i < listaPagina.length; i++) {
            tabela += "<tr>";
            tabela += "<td style='border: 1px solid #ddd;'>" + listaPagina[i].placa + "</td>";
            tabela += "<td style='border: 1px solid #ddd; text-align: center;'><a href='#' onclick=\"apagar('" + listaPagina[i].placa + "')\">x</a></td>";
            tabela += "</tr>";
        }

        tabela += "</table>";
        document.getElementById('tabela_veiculos').innerHTML = tabela;

        atualizarControlesPaginacao();
    }

    function atualizarControlesPaginacao() {
        const totalPaginas = Math.ceil(lista.length / itensPorPagina);
        document.getElementById('info_pagina').innerText = 'Página ' + (paginaAtual + 1) + ' de ' + totalPaginas;
    }

    function paginaAnterior() {
        if (paginaAtual > 0) {
            paginaAtual--;
            gerarTabela();
        }
    }

    function proximaPagina() {
        if ((paginaAtual + 1) * itensPorPagina < lista.length) {
            paginaAtual++;
            gerarTabela();
        }
    }

    function exclui(placa) {
        var ajax = new XMLHttpRequest();
        var form_data = new FormData();
        form_data.append("placa", placa);

        ajax.open("POST", "https://mauricio.inf.br/p6/api/remove/", true);
        ajax.send(form_data);

        ajax.onreadystatechange = function () {
            if (ajax.readyState == 4 && ajax.status == 200) {
                carregaInformacao();
            }
        }
    }

    function apagar(placa) {
        const conf = confirm("Deseja apagar o veiculo de placa " + placa);
        if (conf) {
            exclui(placa);
            document.getElementById('tabela_veiculos').innerHTML = '';
            showDialog();
        }
    }

    function carregaInformacao() {
        showDialog();
        pegaDados();
    }

    function showDialog() {
        document.getElementById('loader').style.display = 'block';
    }

    function hideDialog() {
        document.getElementById('loader').style.display = 'none';
    }

    carregaInformacao();
</script>
</body>
</html>